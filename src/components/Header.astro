<header
  id="main-header"
  class="fixed top-0 w-full z-50
         bg-white/80 backdrop-blur-md
         backdrop-blur-md
         border-b border-gray-200
         transition-all duration-300"
>
  <div
    id="header-inner"
    class="relative max-w-7xl mx-auto
           transition-all duration-300"
  >
    <!-- LOGO -->
    <h1
      id="logo"
      class="absolute left-1/2 -translate-x-1/2
             text-4xl md:text-5xl font-bold text-center
             bg-gradient-to-r from-red-600 to-orange-600
             bg-clip-text text-transparent
             transition-all duration-300"
    >
      Carnitas <span class="font-extrabold">Roque</span>
    </h1>

    <!-- BOTÓN -->
    <div class="flex justify-end">
      <button
        id="phone-toggle"
        class="px-6 py-3 text-lg
               bg-gradient-to-r from-yellow-500 to-orange-500
               text-white rounded-lg
               transition-all duration-300"
      >
        Ingresar teléfono
      </button>
    </div>
  </div>
</header>

<!-- Modal de ingreso de teléfono -->
<div id="phone-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-xl p-6 w-80 shadow-lg">
    <h3 class="text-lg font-semibold mb-4">Ingresa tu número de teléfono</h3>
    <input type="tel" id="phone-input-modal" placeholder="55 1234 5678" class="w-full border px-3 py-2 rounded mb-4">
    <div class="flex justify-end gap-2">
      <button id="phone-cancel" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 transition">Cancelar</button>
      <button id="phone-submit" class="px-4 py-2 rounded bg-yellow-600 text-white hover:bg-yellow-500 transition">Entrar</button>
    </div>
  </div>
</div>

<script>
    const header = document.getElementById('main-header');
  const logo = document.getElementById('logo');
  const button = document.getElementById('phone-toggle');

  function handleScroll() {
    const isTop = window.scrollY === 0;

    header?.classList.toggle('py-10', isTop);
    header?.classList.toggle('py-3', !isTop);

    logo?.classList.toggle('text-5xl', isTop);
    logo?.classList.toggle('text-2xl', !isTop);

    button?.classList.toggle('px-6', isTop);
    button?.classList.toggle('py-3', isTop);
    button?.classList.toggle('text-lg', isTop);

    button?.classList.toggle('px-4', !isTop);
    button?.classList.toggle('py-2', !isTop);
    button?.classList.toggle('text-sm', !isTop);
  }

  window.addEventListener('load', handleScroll);
  window.addEventListener('scroll', handleScroll);
  import { getSupabaseClient } from '../lib/supabaseClient';

  const supabase = getSupabaseClient();
let userPhone = '';

// Elementos
const phoneToggleContainer = document.getElementById('phone-toggle-container');
const phoneToggleBtn = document.getElementById('phone-toggle');
const phoneModal = document.getElementById('phone-modal');
const phoneInputModal = document.getElementById('phone-input-modal');
const phoneCancel = document.getElementById('phone-cancel');
const phoneSubmit = document.getElementById('phone-submit');

// === Función para actualizar botón según estado del teléfono ===
function updatePhoneToggle() {
  const savedPhone = localStorage.getItem('userPhone');
  if (savedPhone) {
    userPhone = savedPhone;
    if (phoneToggleBtn) phoneToggleBtn.textContent = 'Salir';
  } else {
    userPhone = '';
    if (phoneToggleBtn) phoneToggleBtn.textContent = 'Ingresar teléfono';
  }
}

// === Al cargar la página, revisar si hay teléfono guardado ===
window.addEventListener('DOMContentLoaded', () => {
  updatePhoneToggle();

});

// === Click en toggle ===
phoneToggleBtn?.addEventListener('click', () => {
  if (userPhone) {
    // Si ya hay teléfono -> salir
    localStorage.removeItem('userPhone');
    userPhone = '';
    updatePhoneToggle();
  } else {
    // Abrir modal para ingresar teléfono
    if(phoneModal) phoneModal.classList.remove('hidden');
  }
});

// === Cancelar modal ===
phoneCancel?.addEventListener('click', () => {
  if(phoneModal) phoneModal.classList.add('hidden');
});

// === Guardar teléfono desde modal ===
phoneSubmit?.addEventListener('click', async () => {
  const phone = (phoneInputModal as HTMLInputElement)?.value.trim();

  if (!phone) {
    alert("Ingresa un número de teléfono válido.");
    return;
  }

 try {
     const { data: cliente, error: selectError } = await supabase
        .from('clientes')
        .select('telefono')
        .eq('telefono', phone)
        .maybeSingle();

      if (selectError) {
        console.error('Error al verificar cliente:', selectError);
        return;
      }

      if (!cliente) {
        const { error: insertError } = await supabase
          .from('clientes')
          .insert({
            telefono: phone
          });

        if (insertError) {
          console.error('Error al crear cliente:', insertError);
        }
      }

    localStorage.setItem('userPhone', phone);
    userPhone = phone;

    updatePhoneToggle();
    if (phoneModal) phoneModal.classList.add('hidden');

  } catch (err) {
    console.error('Error inesperado:', err);
  }
});

</script>
